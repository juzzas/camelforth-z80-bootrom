HEXLOAD
:10F00000C31BF0C330F0C32AF0C32DF0C339F0C3E3
:10F010003CF0C341F0C346F0C34DF0CD6FF028057E
:10F0200001FFFFE7C9010000E7C9C32FF1C3AEF13B
:10F03000CDFAF0EF6069C366F1C35AF1EF79C3CB43
:10F04000F0EF79C37CF2EF59EF79C38FF2EF79C318
:10F05000AFF0BE1F00000038002000000018C03BC9
:10F0600000010A1F2161F01600197E3253F0C921F8
:10F0700093F006047E3252F0CDA5F0CDA5F0FA8EC5
:10F08000F011FFFFCDA5F0F81B7BB2C284F0231076
:10F09000E3AFC9BE981008CD9BF07BC5ED4B52F095
:10F0A0000CED79C1C9C5ED4B52F00CED78C1C9C565
:10F0B000ED4B52F0ED7910FEC1C9C5ED4B52F01089
:10F0C000FEED78ED4B52F010FEC1C9E60F473A60F5
:10F0D000F0E6F0B03260F01E87C397F0E603473ADF
:10F0E00054F0E6FCB03254F01E81C397F03A54F06D
:10F0F000F6203254F01E81C397F03A54F0E6DF3226
:10F1000054F01E81C397F02180002254F07D1E81AF
:10F11000CD97F07C1E80CD97F03E00CDCBF03E0029
:10F12000CD7CF21100000100403E00CD6DF2C9CD52
:10F1300007F1ED5B56F0CD46F216061E000E0406F2
:10F14000207BCDAFF03C10FA0DC23FF15F15C23D00
:10F15000F121C8002254F0C37BF1CD07F121C0009A
:10F160002254F0C37BF1E5CD07F1E1ED5B5AF001EC
:10F170000008CD5EF221D0002254F03A58F0E6C0EB
:10F180003258F0573A59F0E63F3259F0CB1217CBCC
:10F1900012171E83CD97F0AF325AF03A5BF0E63883
:10F1A000325BF00F0F0F1E84CD97F0C3F9F1CD073E
:10F1B000F1ED5B56F0CD46F20603AFCDAFF03CC2A9
:10F1C000BBF110F721C0022254F0AF3258F0325A8E
:10F1D000F03A59F0E6203259F03EFFC2E0F13E7FAE
:10F1E0001E83CD97F03A5BF0E620325BF03E07C21B
:10F1F000F4F13E031E84CD97F0AF3256F03A57F04B
:10F20000E63C3257F00F0F1E82CD97F03A5EF0E6E3
:10F2100080325EF0573A5FF0E67FCB12171E85CD45
:10F2200097F0AF325CF03A5DF0E638325DF00F0FE8
:10F230000F1E86CD97F01E813A54F0CD97F03A55C7
:10F24000F01E80C397F07BCD9BF07AE63FF640CD71
:10F250009BF0C97BCD9BF07AE63FCD9BF0C9CD46B4
:10F26000F27ECDAFF0230B78B1C261F2C9F5CD4685
:10F27000F2F1CDAFF00DC272F210F7C98787878720
:10F28000473A60F0E60FB03260F01E87C397F01681
:10F2900000210000192929192929295F19ED5B5638
:10F2A000F019EBC346F27EFE00C8CDAFF023C3A633
:10F2B000F2CDAFF010FBC922D8F2C978FEC0D0CD94
:10F2C000FEF279E60706004F21E2F209462A5AF0DB
:10F2D00019EBCD53F2CDBAF0B000F5CD46F2F1C343
:10F2E000AFF08040201008040201F578FEC0D0CDB8
:10F2F000FEF22A58F019EBCD46F2F1C3AFF0780FC9
:0FF300000F0FE61F5779E6F85F78E607B35FC98E
:00000001FF

HEXLOAD
:10E00000000000000000000038446C445444380014
:10E01000387C547C447C380000287C7C7C381000A0
:10E020000010387C7C381000103838107C7C1000D0
:10E030000010387C7C1038000000003030000000F8
:10E04000FCFCFCCCCCFCFCFC0000784848780000D0
:10E05000FCFC84B4B484FCFC001C0C344848300044
:10E060003844443810381000101814103070600014
:10E070000C342C342C6C60000054386C3854000084
:10E080002030383C3830200008183878381808001C
:10E0900010387C107C3810002828282828002800F8
:10E0A0003C545434141414003844302818443800B4
:10E0B000000000000078780010387C107C381038A0
:10E0C00010387C1010101000101010107C38100048
:10E0D0000010187C181000000010307C3010000078
:10E0E0000000004040407C000028287C28280000D8
:10E0F000101038387C7C00007C7C38381010000010
:10E10000000000000000000010383810100010005F
:10E110006C6C48000000000000287C28287C280047
:10E12000203840300870100064640810204C4C0007
:10E1300020505020544834003030200000000000AF
:10E14000102020202020100020101010101020007F
:10E150000028387C382800000010107C10100000C7
:10E1600000000000003030200000007C00000000B3
:10E1700000000000003030000004081020400000C3
:10E1800038444C54644438001030101010103800DB
:10E190003844041820407C003844043804443800D3
:10E1A000081828487C0808007C404078044438005F
:10E1B00018204078444438007C04081020202000B7
:10E1C00038444438444438003844443C040830005F
:10E1D000000030300030300000003030003030209F
:10E1E000081020402010080000007C00007C000087
:10E1F00020100804081020003844041810001000F3
:10E2000038445C545C403800384444447C44440006
:10E2100078444478444478003844404040443800CE
:10E2200078444444444478007C40407840407C003A
:10E230007C404078404040003844405C44443C00CE
:10E240004444447C444444003810101010103800FA
:10E2500004040404444438004448506050484400D6
:10E260004040404040407C00446C5444444444009E
:10E270004464544C444444003844444444443800C6
:10E280007844447840404000384444445448340082
:10E2900078444478484444003844403804443800C2
:10E2A0007C101010101010004444444444443800C2
:10E2B00044444444442810004444545454542800D2
:10E2C00044442810284444004444442810101000BA
:10E2D0007808102040407800382020202020380086
:10E2E000004020100804000038080808080838001A
:10E2F000102844000000000000000000000000FCA6
:10E300003030100000000000000038043C443C00A5
:10E310004040784444447800000038444044380089
:10E3200004043C4444443C00000038447840380035
:10E33000182020782020200000003C44443C043871
:10E340004040704848484800100010101010180055
:10E3500008001808080848304040485060504800FD
:10E36000101010101010180000006854544444009D
:10E3700000007048484848000000384444443800D1
:10E38000000078444444784000003C4444443C0449
:10E390000000582420207000000038403804380065
:10E3A0000020782020281000000048484858280005
:10E3B000000044444428100000004444547C2800D9
:10E3C000000048483048480000004848483810607D
:10E3D00000007808304078001820206020201800C5
:10E3E00010101000101010003008080C0808300041
:10E3F000285000000000000010386C44447C0000ED
:10E4000038444040443810304800484848582800B4
:10E410000C00384478403800380038043C443C0054
:10E42000280038043C443C00300038043C443C00A4
:10E43000382838043C443C0000384440443810300C
:10E440003800384478403800280038447840380094
:10E4500030003844784038002800101010101800A0
:10E4600010280010101018002000101010101800B4
:10E4700028001028447C44003828386C447C440030
:10E480000C007C4078407C00000078147C503C00FC
:10E490003C50507C50505C003800304848483000B8
:10E4A0002800304848483000600030484848300074
:10E4B0003800484848582800600048484858280014
:10E4C00028004848483810604830484848483000DC
:10E4D00028004848484830000010384040381000B4
:10E4E0001824207820245C004428107C107C100024
:10E4F000605050685C4848000814103810105020D4
:10E50000180038043C443C0018001010101018008B
:10E51000180030484848300018004848485828003B
:10E520002850007048484800285000486858480063
:10E5300038043C443C003C003048484830007800F7
:10E54000100010304044380000007C404040000083
:10E550000000FC04040000004048503844081C003F
:10E560004048502C541C0400100010103838100083
:10E570000000244824000000000048244800000057
:10E580005400A8005400A80054A854A854A854A8A3
:10E59000A8FC54FCA8FC54FC101010101010101013
:10E5A000101010F01010101010F010F010101010CB
:10E5B000505050D050505050000000F0505050502B
:10E5C00000F010F01010101050D010D050505050DB
:10E5D000505050505050505000F010D050505050AB
:10E5E00050D010F000000000505050F0000000002B
:10E5F00010F010F000000000000000F010101010EB
:10E600001010101C00000000101010FC0000000092
:10E61000000000FC101010101010101C1010101032
:10E62000000000FC00000000101010FC1010101082
:10E63000101C101C101010105050505C50505050B6
:10E64000505C407C00000000007C405C505050500A
:10E6500050DC00FC0000000000FC00DC505050507A
:10E66000505C405C5050505000FC00FC000000002A
:10E6700050DC00DC5050505010FC00FC000000004A
:10E68000505050FC0000000000FC00FC1010101066
:10E69000000000FC505050505050507C00000000D2
:10E6A000101C101C00000000001C101C101010108A
:10E6B0000000007C50505050505050DC5050505092
:10E6C00010FC00FC10101010101010F000000000E2
:10E6D0000000001C10101010FCFCFCFCFCFCFCFCFE
:10E6E00000000000FCFCFCFCE0E0E0E0E0E0E0E03A
:10E6F0001C1C1C1C1C1C1C1CFCFCFCFC000000004A
:10E7000000003448483400000070487048487040A9
:10E710007848404040404000007C282828282800B5
:10E72000784820102048780000003C48483000001D
:10E730000000484848704040000028501010100069
:10E74000381038443810380030484878484830008D
:10E750000038444428286C003040201038483000ED
:10E760000000285454280000001038545438100079
:10E7700000384078403800000030484848480000E1
:10E780000078007800780000001038100038000091
:10E7900040300830400078000830403008007800F1
:10E7A000000814101010101010101010105020003D
:10E7B0000010007C001000000028500028500000CD
:10E7C00030484830000000000000003030000000F9
:10E7D0000000002000000000001C1010505020001D
:10E7E0005028282800000000601020700000000061
:10E7F0000000787878780000000000000000000039
:00000001FF

HEX

: TMSPROBE?  ( -- flag )
    F000 CALL   ;

: /TMSTEXT  ( -- )
    E000 F003 CALL   ;

: TMSBG     ( c -- )
    F00F CALL   ;

: TMSFG     ( c -- )
    F012 CALL   ;

: TMSAT-XY ( x y -- )
    F015 CALL   ;

: TMSEMIT   ( c -- )
    F018 CALL   ;

: TMSTYPE   ( c-addr u -- )
    0 DO
        DUP C@ TMSEMIT 1+
    LOOP  DROP  ;

: TMSPLOT-XY ( x y -- )
    F01B CALL   ;

: TMSCLR-XY ( x y -- )
    F01E CALL   ;

: TMSINT+ ( -- )
    F021 CALL   ;

: TMSINT- ( -- )
    F024 CALL   ;

8 CONSTANT TMSRAM
9 CONSTANT TMSREG

3800 CONSTANT  'TMSNAME   ( name table address: multiples of 400H )
2000 CONSTANT  'TMSCOLOR  ( color table address: multiples of 40H )
0000 CONSTANT  'TMSPATTERN  ( pattern table: multiples of 800H )
1800 CONSTANT  'TMSSPRITEPATTERN ( sprite attribute table: multiples of 80H )
3BC0 CONSTANT  'TMSSPRITEATTR  ( sprite pattern table: multiples of 800H )

: TMSWRADDR DUP 00FF AND TMSREG PC!
            3F00 AND 8 RSHIFT 40 + TMSREG PC! ;
: TMSRDADDR DUP 00FF AND TMSREG PC!
            3F00 AND 8 RSHIFT TMSREG PC! ;
: TMS!  TMSRAM PC! ;
: TMS@  TMSRAM PC@ ;

: TMSWRITE ( src dest count -- )
  SWAP TMSWRADDR
  0 DO DUP C@ TMS! 1+ LOOP  ;
: TMSFILL ( dest count c -- )
  ROT TMSWRADDR
  SWAP  0 DO DUP TMS! LOOP  ;

: RUN
    TMSPROBE? IF
        ." TMS9918A detected" CR
        /TMSTEXT
        ." TEXT MODE" CR
        1 TMSBG
        5 TMSFG
        ." TEXT colours done" CR
        5 5 TMSAT-XY
        ." TEXT position done" CR
        S" Hello world!!" TMSTYPE
        ." TMSEMIT done" CR
    ELSE
        ." TMS9918A not detected" CR
    THEN    ;
