HEX
E000 RAMTOP !
HEXLOAD

:10F00000C327F0C33CF0C336F0C339F0C345F0C3A7
:10F0100048F0C34DF0C352F0C359F0C35EF0C36B68
:10F02000F0C313F1C320F1CD95F0280501FFFFE7F0
:10F03000C9010000E7C9C355F1C3D4F1CD20F1EFF8
:10F040006069C38CF1C380F1EF79C3F1F0EF79C34C
:10F05000A2F2EF59EF79C3B5F2EF79C3D5F021B041
:10F0600000CDDDF2EF59EF79C3E1F2212FA0CDDD24
:10F07000F2EF59EF79C3E1F2BE1F00000038002023
:10F0800000000018C03B00010A1F2187F01600197C
:10F090007E3279F0C921B9F006047E3278F0CDCB0A
:10F0A000F0CDCBF0FAB4F011FFFFCDCBF0F81B7B25
:10F0B000B2C2AAF02310E3AFC9BE981008CDC1F0C8
:10F0C0007BC5ED4B78F00CED79C1C9C5ED4B78F0FF
:10F0D0000CED78C1C9C5ED4B78F0ED7910FEC1C9D2
:10F0E000C5ED4B78F010FEED78ED4B78F010FEC1D9
:10F0F000C9E60F473A86F0E6F0B03286F01E87C3C5
:10F10000BDF0E603473A7AF0E6FCB0327AF01E81B1
:10F11000C3BDF03A7AF0F620327AF01E81C3BDF01A
:10F120003A7AF0E6DF327AF01E81C3BDF02180002A
:10F13000227AF07D1E81CDBDF07C1E80CDBDF03EDB
:10F1400000CDF1F03E00CDA2F21100000100403EE2
:10F1500000CD93F2C9CD2DF1ED5B7CF0CD6CF216B4
:10F16000061E000E0406207BCDD5F03C10FA0DC221
:10F1700065F15F15C263F121C800227AF0C3A1F1E5
:10F18000CD2DF121C000227AF0C3A1F1E5CD2DF102
:10F19000E1ED5B80F0010008CD84F221D000227AFD
:10F1A000F03A7EF0E6C0327EF0573A7FF0E63F322A
:10F1B0007FF0CB1217CB12171E83CDBDF0AF32807C
:10F1C000F03A81F0E6383281F00F0F0F1E84CDBD8A
:10F1D000F0C31FF2CD2DF1ED5B7CF0CD6CF2060398
:10F1E000AFCDD5F03CC2E1F110F721C002227AF098
:10F1F000AF327EF03280F03A7FF0E620327FF03E90
:10F20000FFC206F23E7F1E83CDBDF03A81F0E620BC
:10F210003281F03E07C21AF23E031E84CDBDF0AF2C
:10F22000327CF03A7DF0E63C327DF00F0F1E82CD4D
:10F23000BDF03A84F0E6803284F0573A85F0E67FFC
:10F24000CB12171E85CDBDF0AF3282F03A83F0E6C7
:10F25000383283F00F0F0F1E86CDBDF01E813A7A33
:10F26000F0CDBDF03A7BF01E80C3BDF07BCDC1F088
:10F270007AE63FF640CDC1F0C97BCDC1F07AE63FDA
:10F28000CDC1F0C9CD6CF27ECDD5F0230B78B1C2E3
:10F2900087F2C9F5CD6CF2F1CDD5F00DC298F21020
:10F2A000F7C987878787473A86F0E60FB03286F03E
:10F2B0001E87C3BDF016002100001929291929292C
:10F2C000295F19ED5B7CF019EBC36CF27EFE00C880
:10F2D000CDD5F023C3CCF2CDD5F010FBC922FEF280
:10F2E000C978FEC0D0CD24F379E60706004F210887
:10F2F000F309462A80F019EBCD79F2CDE0F0B000A9
:10F30000F5CD6CF2F1C3D5F0804020100804020165
:10F31000F578FEC0D0CD24F32A7EF019EBCD6CF247
:10F32000F1C3D5F0780F0F0FE61F5779E6F85F7835
:05F33000E607B35FC910
:00000001FF

HEXLOAD
:10E00000000000000000000038446C445444380014
:10E01000387C547C447C380000287C7C7C381000A0
:10E020000010387C7C381000103838107C7C1000D0
:10E030000010387C7C1038000000003030000000F8
:10E04000FCFCFCCCCCFCFCFC0000784848780000D0
:10E05000FCFC84B4B484FCFC001C0C344848300044
:10E060003844443810381000101814103070600014
:10E070000C342C342C6C60000054386C3854000084
:10E080002030383C3830200008183878381808001C
:10E0900010387C107C3810002828282828002800F8
:10E0A0003C545434141414003844302818443800B4
:10E0B000000000000078780010387C107C381038A0
:10E0C00010387C1010101000101010107C38100048
:10E0D0000010187C181000000010307C3010000078
:10E0E0000000004040407C000028287C28280000D8
:10E0F000101038387C7C00007C7C38381010000010
:10E10000000000000000000010383810100010005F
:10E110006C6C48000000000000287C28287C280047
:10E12000203840300870100064640810204C4C0007
:10E1300020505020544834003030200000000000AF
:10E14000102020202020100020101010101020007F
:10E150000028387C382800000010107C10100000C7
:10E1600000000000003030200000007C00000000B3
:10E1700000000000003030000004081020400000C3
:10E1800038444C54644438001030101010103800DB
:10E190003844041820407C003844043804443800D3
:10E1A000081828487C0808007C404078044438005F
:10E1B00018204078444438007C04081020202000B7
:10E1C00038444438444438003844443C040830005F
:10E1D000000030300030300000003030003030209F
:10E1E000081020402010080000007C00007C000087
:10E1F00020100804081020003844041810001000F3
:10E2000038445C545C403800384444447C44440006
:10E2100078444478444478003844404040443800CE
:10E2200078444444444478007C40407840407C003A
:10E230007C404078404040003844405C44443C00CE
:10E240004444447C444444003810101010103800FA
:10E2500004040404444438004448506050484400D6
:10E260004040404040407C00446C5444444444009E
:10E270004464544C444444003844444444443800C6
:10E280007844447840404000384444445448340082
:10E2900078444478484444003844403804443800C2
:10E2A0007C101010101010004444444444443800C2
:10E2B00044444444442810004444545454542800D2
:10E2C00044442810284444004444442810101000BA
:10E2D0007808102040407800382020202020380086
:10E2E000004020100804000038080808080838001A
:10E2F000102844000000000000000000000000FCA6
:10E300003030100000000000000038043C443C00A5
:10E310004040784444447800000038444044380089
:10E3200004043C4444443C00000038447840380035
:10E33000182020782020200000003C44443C043871
:10E340004040704848484800100010101010180055
:10E3500008001808080848304040485060504800FD
:10E36000101010101010180000006854544444009D
:10E3700000007048484848000000384444443800D1
:10E38000000078444444784000003C4444443C0449
:10E390000000582420207000000038403804380065
:10E3A0000020782020281000000048484858280005
:10E3B000000044444428100000004444547C2800D9
:10E3C000000048483048480000004848483810607D
:10E3D00000007808304078001820206020201800C5
:10E3E00010101000101010003008080C0808300041
:10E3F000285000000000000010386C44447C0000ED
:10E4000038444040443810304800484848582800B4
:10E410000C00384478403800380038043C443C0054
:10E42000280038043C443C00300038043C443C00A4
:10E43000382838043C443C0000384440443810300C
:10E440003800384478403800280038447840380094
:10E4500030003844784038002800101010101800A0
:10E4600010280010101018002000101010101800B4
:10E4700028001028447C44003828386C447C440030
:10E480000C007C4078407C00000078147C503C00FC
:10E490003C50507C50505C003800304848483000B8
:10E4A0002800304848483000600030484848300074
:10E4B0003800484848582800600048484858280014
:10E4C00028004848483810604830484848483000DC
:10E4D00028004848484830000010384040381000B4
:10E4E0001824207820245C004428107C107C100024
:10E4F000605050685C4848000814103810105020D4
:10E50000180038043C443C0018001010101018008B
:10E51000180030484848300018004848485828003B
:10E520002850007048484800285000486858480063
:10E5300038043C443C003C003048484830007800F7
:10E54000100010304044380000007C404040000083
:10E550000000FC04040000004048503844081C003F
:10E560004048502C541C0400100010103838100083
:10E570000000244824000000000048244800000057
:10E580005400A8005400A80054A854A854A854A8A3
:10E59000A8FC54FCA8FC54FC101010101010101013
:10E5A000101010F01010101010F010F010101010CB
:10E5B000505050D050505050000000F0505050502B
:10E5C00000F010F01010101050D010D050505050DB
:10E5D000505050505050505000F010D050505050AB
:10E5E00050D010F000000000505050F0000000002B
:10E5F00010F010F000000000000000F010101010EB
:10E600001010101C00000000101010FC0000000092
:10E61000000000FC101010101010101C1010101032
:10E62000000000FC00000000101010FC1010101082
:10E63000101C101C101010105050505C50505050B6
:10E64000505C407C00000000007C405C505050500A
:10E6500050DC00FC0000000000FC00DC505050507A
:10E66000505C405C5050505000FC00FC000000002A
:10E6700050DC00DC5050505010FC00FC000000004A
:10E68000505050FC0000000000FC00FC1010101066
:10E69000000000FC505050505050507C00000000D2
:10E6A000101C101C00000000001C101C101010108A
:10E6B0000000007C50505050505050DC5050505092
:10E6C00010FC00FC10101010101010F000000000E2
:10E6D0000000001C10101010FCFCFCFCFCFCFCFCFE
:10E6E00000000000FCFCFCFCE0E0E0E0E0E0E0E03A
:10E6F0001C1C1C1C1C1C1C1CFCFCFCFC000000004A
:10E7000000003448483400000070487048487040A9
:10E710007848404040404000007C282828282800B5
:10E72000784820102048780000003C48483000001D
:10E730000000484848704040000028501010100069
:10E74000381038443810380030484878484830008D
:10E750000038444428286C003040201038483000ED
:10E760000000285454280000001038545438100079
:10E7700000384078403800000030484848480000E1
:10E780000078007800780000001038100038000091
:10E7900040300830400078000830403008007800F1
:10E7A000000814101010101010101010105020003D
:10E7B0000010007C001000000028500028500000CD
:10E7C00030484830000000000000003030000000F9
:10E7D0000000002000000000001C1010505020001D
:10E7E0005028282800000000601020700000000061
:10E7F0000000787878780000000000000000000039
:00000001FF

HEX

: TMSPROBE?  ( -- flag )
    F000 CALL   ;

: /TMSTEXT  ( -- )
    E000 F003 CALL   ;

: TMSBG     ( c -- )
    F00F CALL   ;

: TMSFG     ( c -- )
    F012 CALL   ;

: TMSAT-XY ( x y -- )
    F015 CALL   ;

: TMSEMIT   ( c -- )
    F018 CALL   ;

: TMSTYPE   ( c-addr u -- )
    0 DO
        DUP C@ TMSEMIT 1+
    LOOP  DROP  ;

: TMSPLOT-XY ( x y -- )
    F01B CALL   ;

: TMSCLR-XY ( x y -- )
    F01E CALL   ;

: TMSINT+ ( -- )
    F021 CALL   ;

: TMSINT- ( -- )
    F024 CALL   ;

8 CONSTANT TMSRAM
9 CONSTANT TMSREG

3800 CONSTANT  'TMSNAME   ( name table address: multiples of 400H )
2000 CONSTANT  'TMSCOLOR  ( color table address: multiples of 40H )
0000 CONSTANT  'TMSPATTERN  ( pattern table: multiples of 800H )
1800 CONSTANT  'TMSSPRITEPATTERN ( sprite attribute table: multiples of 80H )
3BC0 CONSTANT  'TMSSPRITEATTR  ( sprite pattern table: multiples of 800H )

: TMSWRADDR DUP 00FF AND TMSREG PC!
            3F00 AND 8 RSHIFT 40 + TMSREG PC! ;
: TMSRDADDR DUP 00FF AND TMSREG PC!
            3F00 AND 8 RSHIFT TMSREG PC! ;
: TMS!  TMSRAM PC! ;
: TMS@  TMSRAM PC@ ;

: TMSWRITE ( src dest count -- )
  SWAP TMSWRADDR
  0 DO DUP C@ TMS! 1+ LOOP  ;
: TMSFILL ( dest count c -- )
  ROT TMSWRADDR
  SWAP  0 DO DUP TMS! LOOP  ;

VARIABLE INTCOUNT  0 INTCOUNT !
VARIABLE SECCOUNT  0 SECCOUNT !

: IC+
  1 INTCOUNT +!
  INTCOUNT @ 32 > IF
    0 INTCOUNT !
    1 SECCOUNT +! 
  THEN ;

: INTHANDLER
  TMSREG PC@ AND 80 IF IC+ THEN  ;
  

: RUN
    TMSPROBE? IF
        ." TMS9918A detected" CR
        /TMSTEXT
        ." TEXT MODE" CR
        1 TMSBG
        5 TMSFG
        ." TEXT colours done" CR
        5 5 TMSAT-XY
        ." TEXT position done" CR
        S" Hello world!!" TMSTYPE
        ." TMSEMIT done" CR
    ELSE
        ." TMS9918A not detected" CR
    THEN    ;

( output count to screen )
: T
  1 1 TMSAT-XY
  SECCOUNT @ 
  (.) TMSTYPE ;

' INTHANDLER INTVEC !

